pipeline {
    agent any

    stages {
        stage('Deploy to Production') {
            steps {
                sshagent(['ec2-ssh-credentials-id']) {
                    sh '''
                        ssh -o StrictHostKeyChecking=no ec2-user@52.90.95.71  "
                            docker stop production-container || true &&
                            docker rm production-container || true &&
                            docker pull realsahilthakur/devopsbookstore:latest &&
                            docker run --name production-container -d -p 8083:80 realsahilthakur/devopsbookstore:latest
                        "
                    '''
                }
            }
        }
    }

    post {
        success {
            echo 'Production deployment successful!'
        }
        failure {
            echo 'Production deployment failed!'
        }
    }
}
