pipeline {
    agent any

    stages {
        stage('Deploy to Production') {
            steps {
                // Use SSH agent to connect to EC2 instance
                sshagent(['ec2-ssh-credentials-id']) {
                    sh '''
                        ssh -o StrictHostKeyChecking=no ec2-user@52.90.95.71  "
                            docker stop book-production || true &&
                            docker rm book-production || true &&
                            docker pull realsahilthakur/devops-bookstore:latest &&
                            docker run --name book-production -d -p 80:80 realsahilthakur/devops-bookstore:latest
                        "
                    '''
                }
            }
        }
    }

    post {
        success {
            echo "Production deployment successful!"
        }
        failure {
            echo "Production deployment failed."
        }
    }
}
